name: ğŸ¯ AnÃ¡lise de PontuaÃ§Ã£o - Consultores

on:
  workflow_dispatch:
    inputs:
      planilha_cadastros:
        description: 'ğŸ“‹ Planilha de CADASTROS (todos os consultores do site)'
        required: true
        type: attachment
      planilha_pontuacao:
        description: 'ğŸ† Planilha de PONTUAÃ‡ÃƒO do mÃªs (quem pontuou)'
        required: true
        type: attachment

jobs:
  analisar:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“‚ Checkout
        uses: actions/checkout@v4

      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸ“¦ Instalar dependÃªncias
        run: |
          python -m pip install --upgrade pip
          pip install pandas openpyxl rapidfuzz unidecode

      - name: ğŸ“¥ Preparar planilhas
        run: |
          mkdir -p inputs/{cadastros,pontuacao,outputs}
          
          # Copia os arquivos do attachment para as pastas
          cp "${{ inputs.planilha_cadastros }}" inputs/cadastros/
          cp "${{ inputs.planilha_pontuacao }}" inputs/pontuacao/
          
          echo "ğŸ“ Arquivos preparados:"
          echo "Cadastros:"
          ls -la inputs/cadastros/
          echo "PontuaÃ§Ã£o:"
          ls -la inputs/pontuacao/

      - name: ğŸ” Executar anÃ¡lise de pontuaÃ§Ã£o
        run: |
          echo "ğŸš€ Iniciando anÃ¡lise..."
          python analise_pontuacao.py
          
          echo "ğŸ“Š Resumo dos resultados:"
          if [ -f outputs/resultado_*.xlsx ]; then
            ls -la outputs/
          else
            echo "âŒ Nenhum arquivo de resultado encontrado!"
            exit 1
          fi

      - name: ğŸ“¤ Upload resultado final
        uses: actions/upload-artifact@v4
        with:
          name: ğŸ¯-resultado-pontuacao-${{ github.run_number }}
          path: outputs/resultado_*.xlsx
          retention-days: 30

      - name: ğŸ“Š EstatÃ­sticas finais
        if: always()
        run: |
          if [ -f outputs/resultado_*.xlsx ]; then
            echo "âœ… AnÃ¡lise concluÃ­da com sucesso!"
            echo "ğŸ“¥ Baixe o arquivo de resultados no painel de Artifacts"
          else
            echo "âŒ AnÃ¡lise falhou - verifique os logs acima"
          fi
